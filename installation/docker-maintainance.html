<!DOCTYPE html>
<html lang="en">
<head>


    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-92673120-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-92673120-3');
    </script>


    <!-- Title -->
  <title>Nearby Shops | Developer : Quick Installation Guide</title>

  <!-- Required Meta Tags Always Come First -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Favicon -->
  <link rel="shortcut icon" href="favicon.ico">

  <!-- Google Fonts -->
  <link href="//fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

  <!-- CSS Implementing Plugins -->
  <link rel="stylesheet" href="/assets/vendor/font-awesome/css/fontawesome-all.min.css">
  <link rel="stylesheet" href="/assets/vendor/animate.css/animate.min.css">
  <link rel="stylesheet" href="/assets/vendor/hs-megamenu/src/hs.megamenu.css">
  <link rel="stylesheet" href="/assets/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css">
  <link rel="stylesheet" href="/assets/vendor/cubeportfolio/css/cubeportfolio.min.css">


  <link rel="stylesheet" href="/assets/vendor/jquery-ui/themes/base/jquery-ui.min.css">
  <link rel="stylesheet" href="/assets/vendor/prism/prism.css">



  <!-- CSS Front Template -->
  <link rel="stylesheet" href="/assets/css/theme.css">

  <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css"/>



  <!-- CSS Front Doc -->
  <link rel="stylesheet" href="/assets/css/starter.css">


  <style>

    p{
      color: #0a0a0a;
      font-family:Helvetica Neue, Helvetica, Arial, sans-serif;
    }


    /*font-family: "Helvetica Neue", Arial, sans-serif;*/

    h2{
      color: orange;
      font-weight: normal;
      margin-top: 30px;
      margin-bottom: 30px;
    }

    h3{
      color: green;
      font-weight: lighter;
      font-size: larger;
    }



  </style>


</head>
<body data-spy="scroll" data-target="#toc">



  <div id="header"></div>


  <!-- ========== MAIN ========== -->
  <main id="content" role="main">
    <!-- Search Section -->
    <div class="gradient-half-primary-v1">
      <div class="bg-img-hero-center" style="background-image: url(/assets/svg/components/bg-elements-10.svg);">
        <div class="container space-1">
          <div class="d-inline-block">
            <a href="installation-guide-quick-docker.html" data-toc-skip class="h5 text-white">Installation</a>
            <a data-toc-skip class="h5 text-white font-size-2 font-weight-light ml-2 mr-2">/</a>
            <a href="installation-guide-quick-docker.html" data-toc-skip class="h5 text-white font-weight-normal">Quick Installation Guide</a>
          </div>
        </div>
      </div>
    </div>
    <!-- End Search Section -->


    <div class="container-fluid pl-3 pr-3">
      <div class="row">

        <div class="col-lg-3 col-12 pl-5 text-center d-inline-block">
          <div id="table-of-contents" class="sticky-top"></div>
        </div>


      <!-- main content area -->
      <div class="col-lg-6">


          <!-- Article Section -->
          <div class="space-bottom-2">
            <div class="">

              <!-- Article -->
              <div class="card shadow-sm p-lg-7 p-4">
                <h2 >Docker Maintainaince</h2>
                <p class="font-size-2">
                </p>



                <h3>Prerequisite Knowledge</h3>
                <p>
                  If you are familier with using linux terminal commands that would be sufficient. 
                </p>


                
                <h3>Why this topic ?</h3>
                <p> 
                  In this tutorial we will study the common maintainaince procedures you need to follow in order to maintain your server installed using Docker. 
                </p>


      
                <h3 >Topics Covered</h3>

                <p>Upgrading / Updating your Backend Instance</br>
                    Enable Remote access to your Database</br>
                    Run multiple Instances on One Server</br>
                    Backup and Restore your Instance Data
                </p>

                




                <h2>Upgrading / Updating your Backend Instance</h2>

                
                <p>Every Software needs to be updated. And you will need to update your server too. In this tutorial we will see
                  how to update your server instance installed using docker. 
                </p>


                <p>
                  Please note when you upgrade / update your docker container all your data will be deleted except for your data stored
                  in <b>~/nearbyshops/data</b> folder and data stored in PostgreSQL database. 
                  So before updating your server please ensure that you dont have any important data stored outside of these folders. 
                </p>

                <p>
                  To update your docker container use the following commands. 
                </p>


                <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Commands</span>
                  <code class="border-top">

    docker-compose down
    (please ensure that you are inside the directory where docker-compose.yml resides)

    docker rmi nearbyshops/nearbyshops:latest --force

    docker-compose up
                </code>
                </pre>




                <p>
                   After you do docker-compose up it will download the new docker image and create a container out of that new image. Your data stored 
                   in <b>~/nearbyshops/data</b> folder and data stored in PostgreSQL database will be preserved. 
                </p>





                <h2>Enable Remote access to your Database</h2>


                <p>We use PostgreSQL as our primary Database. Sometimes you may need / want to have direct access to your Database.
                    This need can arise due to various reasons. 
                    You may want to make some update in the database which you are not able to do using the app. 
                    You may want to analyze the database and do some research on your data. 
                    There could be many other reasons. 
                </p>


                <p>
                  To enable access to your Database of your Server follow these instructions. 
                </p>

                <p>
                  Open your docker-compose.yml file using a text editor
                </p>


                <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">  Optional Commands</span>
                  <code class="border-top">
    sudo nano docker-compose.yml
                </code>
                </pre>



                <p>
                  Add  - "5432:5432" to the ports section of docker-compose.yml file. 
                  <br><br>
                  After making an update to your docker-compose.yml file your 
                  docker compose file will look 
                  something like the file given below. Please note the addition of new line in the ports section. 
                  This tells docker to enable access to the port 5432 from the outside world. 5432 is the default port on 
                  which the PostgreSQL Database works. And for our installation also 5432 is the port which we use for PostgreSQL Database. 
                </p>




                <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">  Optional Commands</span>
                  <code class="border-top">
    version: '3.6'
    services:
      nbs_api:
        image: nearbyshops/nearbyshops
        ports:
          - "80:80"
          - "5432:5432"
        container_name: nbs_api_container
        volumes:
          - db_data:/var/lib/postgresql/12/main
          - api_data:/root/nearbyshops/data
        restart: always
        entrypoint: ["/root/nbs.sh"]                    
                </code>
                </pre>



                <p>By default PostgreSQL is configured to be accessed only internally on a local server. This is done for Security Reasons. 
                   You need to change the PostgreSQL configuration settings in order to allow the database access from a Remote Computer or Say outside world.  
                   In order to accomplish this we need to get inside our container and follow a prodecure</p>



                <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Commands</span>
                  <code class="border-top">

    docker-compose start
    (please ensure that you are inside the directory where docker-compose.yml resides)

    docker exec -it nbs_api_container bash

    (Exit container using Ctrl + C or Ctrl + D)
                </code>
                </pre>


                <p>After getting inside the Docker Container please follow the prodecure given in this guide. 
                   <a href="/database/enable-remote-access-to-postgres.html">Enable Remote Access to PostgreSQL</a>
                </p>






                <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Commands</span>
                  <code class="border-top">
    (Exit container using Ctrl + C or Ctrl + D)

    docker-compose restart
    (please ensure that you are inside the directory where docker-compose.yml resides)
                </code>
                </pre>


                <p>Exit container after following above procedure. And then restart the container to apply the changes.</p>

                <p>After following the above procedure you can connect to your database using PGadmin4 database utility. 
                  Install PGAdmin4 and add a new server with host ip and database user and password given in your api_config.properties file. </p>



                <h2>Run multiple Instances on One Server</h2>


                <p>Yes you can run multiple docker instances on one server. In order to run multiple instances you need to change and assign different 
                  port for each instance. And you also need to change the container name such that each instance has different container name. 
                </p>


                <p>
                  The best practice is the create a different folder for each instance where you can download and edit the docker compose file for that instance.
                </p>




                <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Commands</span>
                  <code class="border-top">
    cd ~
    mkdir instanceOne
    cd instanceOne

    wget https://raw.githubusercontent.com/NearbyShops/Nearby-Shops-API/master/docker-compose.yml

    nano docker-compose.yml

    (Update the port number and container name to ensure that they are unique)
      </code>
                </pre>



                <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Commands</span>
                  <code class="border-top">
    cd ~
    mkdir instanceTwo
    cd instanceTwo

    wget https://raw.githubusercontent.com/NearbyShops/Nearby-Shops-API/master/docker-compose.yml

    nano docker-compose.yml

    (Update the port number and container name to ensure that they are unique)
      </code>
                </pre>

                <p>
                  After updating the docker compose file for each instance. You can proceed with the instructions given in our docker quick installation guide. 
                </p>







                <h2>Backup and Restore your Instance Data</h2>

                <p>
                  To backup your data in the Docker Instance you can use Docker Commit command. Which commits / saves the container data in an image. 
                  Then you can use Docker Push Command to push the image to the docker hub. 
                </p>



                <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Commands</span>
                  <code class="border-top">
    docker commit nbs_api_container your_backup
    
    docker push your_backup

    (you must be logged into your docker hub account. If no then login using the following command.)
    docker login --username=yourhubusername --email=youremail@company.com
      </code>
                </pre>



                <p>
                  Whenever you want to restore the container from a backup you can simply create a container from the image you saved as your backup. 
                </p>









                  <p class="border-top space-top-2 font-size-2 font-weight-light">
                      Facing difficulty in understanding anything ? ... let us help you !
                      If you have any questions and queries do not hesitate to get in touch with us on our
                      <a href="http://forum.nearbyshops.org">forum</a>
                  </p>


              </div>
              <!-- End Article -->



            </div>
          </div>
          <!-- End Article Section -->

      </div>



        <!-- sidebar, which will move to the top on a small screen -->
        <div class="col-lg-3">

          <nav id="toc" data-toggle="toc" class="sticky-top space-2 font-size-5">
            <p class="font-weight-light ml-3 text-primary font-size-2">On this page</p>
          </nav>
        </div>


      </div>
    </div>
  </main>
  <!-- ========== END MAIN ========== -->




  <div id="footer"></div>



  <!-- Go to Top -->
  <a class="js-go-to u-go-to" href="#"
    data-position='{"bottom": 15, "right": 15 }'
    data-type="fixed"
    data-offset-top="400"
    data-compensation="#header"
    data-show-effect="slideInUp"
    data-hide-effect="slideOutDown">
    <span class="fas fa-arrow-up u-go-to__inner"></span>
  </a>
  <!-- End Go to Top -->

  <!-- JS Global Compulsory -->
  <script src="/assets/vendor/jquery/dist/jquery.min.js"></script>
  <script src="/assets/vendor/jquery-migrate/dist/jquery-migrate.min.js"></script>
  <script src="/assets/vendor/popper.js/dist/umd/popper.min.js"></script>
  <script src="/assets/vendor/bootstrap/bootstrap.min.js"></script>

  <!-- add after bootstrap.min.js -->
  <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>



  <!-- JS Implementing Plugins -->
  <script src="/assets/vendor/hs-megamenu/src/hs.megamenu.js"></script>
  <script src="/assets/vendor/svg-injector/dist/svg-injector.min.js"></script>
  <script src="/assets/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="/assets/vendor/jquery-validation/dist/jquery.validate.min.js"></script>

  <!-- JS Front -->
  <script src="/assets/js/hs.core.js"></script>
  <script src="/assets/js/components/hs.header.js"></script>
  <script src="/assets/js/components/hs.unfold.js"></script>
  <script src="/assets/js/components/hs.malihu-scrollbar.js"></script>
  <script src="/assets/js/components/hs.validation.js"></script>
  <script src="/assets/js/components/hs.focus-state.js"></script>
  <script src="/assets/js/components/hs.show-animation.js"></script>
  <script src="/assets/js/components/hs.svg-injector.js"></script>
  <script src="/assets/js/components/hs.go-to.js"></script>

  <!-- JS Plugins Init. -->
  <script>


    $(function(){
        $("#header").load("../header.html");
        $("#footer").load("../footer.html");


      $("#table-of-contents").load("table-of-contents-installation.html");

    });


    $(window).on('load', function () {
      // initialization of HSMegaMenu component
      $('.js-mega-menu').HSMegaMenu({
        event: 'hover',
        pageContainer: $('.container'),
        breakpoint: 767.98,
        hideTimeOut: 0
      });

      // initialization of svg injector module
      $.HSCore.components.HSSVGIngector.init('.js-svg-injector');
    });

    $(document).on('ready', function () {
      // initialization of header
      $.HSCore.components.HSHeader.init($('#header'));

      // initialization of unfold component
      $.HSCore.components.HSUnfold.init($('[data-unfold-target]'), {
        afterOpen: function () {
          $(this).find('input[type="search"]').focus();
        }
      });

      // initialization of malihu scrollbar
      $.HSCore.components.HSMalihuScrollBar.init($('.js-scrollbar'));

      // initialization of show animations
      $.HSCore.components.HSShowAnimation.init('.js-animation-link');

      // initialization of form validation
      $.HSCore.components.HSValidation.init('.js-validate', {
        rules: {
          confirmPassword: {
            equalTo: '#signupPassword'
          }
        }
      });

      // initialization of forms
      $.HSCore.components.HSFocusState.init();

      // initialization of go to
      $.HSCore.components.HSGoTo.init('.js-go-to');
    });
  </script>
</body>
</html>