<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-92673120-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-92673120-3');
    </script>


    <!-- Title -->
  <title>Nearby Shops | Developer : Upgrade Postgres Database</title>

  <!-- Required Meta Tags Always Come First -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Favicon -->
  <link rel="shortcut icon" href="favicon.ico">

  <!-- Google Fonts -->
  <link href="//fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

  <!-- CSS Implementing Plugins -->
  <link rel="stylesheet" href="../assets/vendor/font-awesome/css/fontawesome-all.min.css">
  <link rel="stylesheet" href="../assets/vendor/animate.css/animate.min.css">
  <link rel="stylesheet" href="../assets/vendor/hs-megamenu/src/hs.megamenu.css">
  <link rel="stylesheet" href="../assets/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css">
  <link rel="stylesheet" href="../assets/vendor/cubeportfolio/css/cubeportfolio.min.css">


  <link rel="stylesheet" href="../assets/vendor/jquery-ui/themes/base/jquery-ui.min.css">
  <link rel="stylesheet" href="../assets/vendor/prism/prism.css">



  <!-- CSS Front Template -->
  <link rel="stylesheet" href="../assets/css/theme.css">

  <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css"/>



  <!-- CSS Front Doc -->
  <link rel="stylesheet" href="../assets/css/starter.css">


  <style>

    p{
      color: #0a0a0a;
      font-family:Helvetica Neue, Helvetica, Arial, sans-serif;
    }


    /*font-family: "Helvetica Neue", Arial, sans-serif;*/

    h2{
      color: orange;
      font-weight: normal;
      margin-top: 30px;
      margin-bottom: 30px;
    }

    h3{
      color: green;
      font-weight: lighter;
      font-size: larger;
    }



  </style>


</head>
<body data-spy="scroll" data-target="#toc">



  <div id="header"></div>


  <!-- ========== MAIN ========== -->
  <main id="content" role="main">
    <!-- Search Section -->
    <div class="gradient-half-primary-v1">
      <div class="bg-img-hero-center" style="background-image: url(../assets/svg/components/bg-elements-10.svg);">
        <div class="container space-1">
          <div class="d-inline-block">
            <a href="install-postgres.html" data-toc-skip class="h5 text-white">Database</a>
            <a data-toc-skip class="h5 text-white font-size-2 font-weight-light ml-2 mr-2">/</a>
            <a href="#" data-toc-skip class="h5 text-white font-weight-normal">Upgrade Postgres Database</a>
          </div>
        </div>
      </div>
    </div>
    <!-- End Search Section -->



    <div class="container-fluid pl-3 pr-3">
      <div class="row">

        <div class="col-lg-3 col-12 pl-5 text-center d-inline-block">
          <div id="table-of-contents" class="sticky-top"></div>
        </div>


      <!-- main content area -->
      <div class="col-lg-6">


          <!-- Article Section -->
          <div class="space-bottom-2">
            <div class="">

              <!--&lt;!&ndash; Breadcrumbs &ndash;&gt;-->
              <!--<nav aria-label="breadcrumb">-->
                <!--<ol class="breadcrumb breadcrumb-no-gutter font-size-1 space-1">-->
                  <!--<li class="breadcrumb-item"><a href="help.html">Front Help Center</a></li>-->
                  <!--<li class="breadcrumb-item"><a href="help.html">Getting started</a></li>-->
                  <!--<li class="breadcrumb-item active" aria-current="page">What's Front?</li>-->
                <!--</ol>-->
              <!--</nav>-->
              <!--&lt;!&ndash; End Breadcrumbs &ndash;&gt;-->



              <!-- Article -->
              <div class="card shadow-sm p-lg-7 p-4">
                <h2 >Upgrade PostgreSQL Database</h2>
                <p class="font-size-2">In this article we will learn how to upgrade PostgreSQL Database on ubuntu</p>

                  <p>
                      In this tutorial we will see a step by step guide for
                      how to upgrade postgres database without losing data using the pg_upgrade utility tool provided.
                      This guide is written for upgrading to postgres 9.6 but it can be generalized to upgrade to any version.
                  </p>



                <h3>Prerequisite Knowledge</h3>
                  <p>
                  To understand this upgrade guide you dont need to be an expert but having some basic knowledge of linux terminal commands and postgres Database will help you.
                  </p>



                <h3 >Steps for Upgrade</h3>

                <p> Step 1 : Install postgres newer Version</br>
                    Step 2 : Upgrade cluster using pg_upgrade utility
                </p>







                  <h2 >Step 1 : Install postgres newer version</h2>


                  <p >
                      Install postgres 9.6 using these instructions
                      </br>

                      <a href="https://tecadmin.net/install-postgresql-server-on-ubuntu/">
                          Link : https://tecadmin.net/install-postgresql-server-on-ubuntu/
                      </a>
                  </p>




                  <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Code</span>
                  <code class="border-top">
    $ sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt/ `lsb_release -cs`-pgdg main" >> /etc/apt/sources.list.d/pgdg.list'
    $ wget -q https://www.postgresql.org/media/keys/ACCC4CF8.asc -O - | sudo apt-key add -
                    </code>
                  </pre>




                  <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Code</span>
                  <code class="border-top">
      $ sudo apt-get update
      $ sudo apt-get install postgresql postgresql-contrib
                    </code>
                  </pre>





                  <h2>Step 2 : Upgrade cluster using pg_upgrade utility</h2>

                  <p>Run <b>pg_lsclusters</b> your 9.5 and 9.6 main clusters should be “online”.</p>




                  <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Code</span>
                  <code class="border-top">
    pg_lsclusters
    Ver Cluster Port Status Owner    Data directory               Log file
    9.5 main    5432 online postgres /var/lib/postgresql/9.3/main /var/log/postgresql/postgresql-9.5-main.log
    9.6 main    5433 online postgres /var/lib/postgresql/9.5/main /var/log/postgresql/postgresql-9.6-main.log
                    </code>
                  </pre>


                  <p>
                      There already is a cluster “main” for 9.6 (since this is created by default on package installation).
                      This is done so that a fresh installation works out of the box without the need to create a cluster first,
                      but of course it clashes when you try to upgrade 9.5/main when 9.6/main also exists.
                      The recommended procedure is to remove the 9.6 cluster with pg_dropcluster and then upgrade with pg_upgradecluster.
                  </p>


                  <p>Stop the 9.6 cluster and drop it.</p>



                  <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Code</span>
                  <code class="border-top">
    sudo pg_dropcluster 9.6 main --stop
                    </code>
                  </pre>


                  <p>Upgrade the 9.5 cluster to the latest version.</p>



                  <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Code</span>
                  <code class="border-top">
    sudo pg_upgradecluster 9.5 main
                    </code>
                  </pre>



                  <p>when you type the above command you might get an error stating you “Unable to stop postgres ” or “Postgres server did not shut-down”.
                      </br></br>
                      So we will need to stop the postgres server before we type the above command.
                      To stop the Postgres server please type the following command.
                  </p>


                  <p class="font-weight-bold font-size-2">sudo systemctl stop postgresql@9.5-main</p>


                  <p>OR (You can also type the following command as an alternative)</p>


                  <p class="font-weight-bold font-size-2">sudo pg_ctlcluster 9.5 main stop –force</p>


                  <p>after stopping the server please type the upgrade command again</p>



                  <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Code</span>
                  <code class="border-top">
    sudo pg_upgradecluster 9.5 main
                    </code>
                  </pre>


                  <p>Your 9.5 cluster should now be “down”.</p>


                  <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Code</span>
                  <code class="border-top">
    pg_lsclusters
    Ver Cluster Port Status Owner    Data directory               Log file
    9.5 main    5433 down   postgres /var/lib/postgresql/9.5/main /var/log/postgresql/postgresql-9.5-main.log
    9.6 main    5432 online postgres /var/lib/postgresql/9.6/main /var/log/postgresql/postgresql-9.6-main.log
                    </code>
                  </pre>



                  <p>Check that the upgraded cluster works, then remove the 9.5 cluster.</p>



                  <pre class="card bg-light align-content-start">
                  <span class="fas fa-code p-3">   Code</span>
                  <code class="border-top">
    sudo pg_dropcluster 9.5 main
                    </code>
                  </pre>



                  <p>The above instructions are taken from this link</p>



                  <a href="https://gist.github.com/SumeetMoray/c8a0343822b4a07c72b90daf08fb125b">
                      Link : https://gist.github.com/SumeetMoray/c8a0343822b4a07c72b90daf08fb125b
                  </a>




              </div>
              <!-- End Article -->



            </div>
          </div>
          <!-- End Article Section -->

      </div>



        <!-- sidebar, which will move to the top on a small screen -->
        <div class="col-lg-3">

          <nav id="toc" data-toggle="toc" class="sticky-top space-2 font-size-5">
            <p class="font-weight-light ml-3 text-primary font-size-2">On this page</p>
          </nav>
        </div>


      </div>
    </div>
  </main>
  <!-- ========== END MAIN ========== -->




  <div id="footer"></div>



  <!-- Go to Top -->
  <a class="js-go-to u-go-to" href="#"
    data-position='{"bottom": 15, "right": 15 }'
    data-type="fixed"
    data-offset-top="400"
    data-compensation="#header"
    data-show-effect="slideInUp"
    data-hide-effect="slideOutDown">
    <span class="fas fa-arrow-up u-go-to__inner"></span>
  </a>
  <!-- End Go to Top -->

  <!-- JS Global Compulsory -->
  <script src="../assets/vendor/jquery/dist/jquery.min.js"></script>
  <script src="../assets/vendor/jquery-migrate/dist/jquery-migrate.min.js"></script>
  <script src="../assets/vendor/popper.js/dist/umd/popper.min.js"></script>
  <script src="../assets/vendor/bootstrap/bootstrap.min.js"></script>

  <!-- add after bootstrap.min.js -->
  <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>



  <!-- JS Implementing Plugins -->
  <script src="../assets/vendor/hs-megamenu/src/hs.megamenu.js"></script>
  <script src="../assets/vendor/svg-injector/dist/svg-injector.min.js"></script>
  <script src="../assets/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../assets/vendor/jquery-validation/dist/jquery.validate.min.js"></script>

  <!-- JS Front -->
  <script src="../assets/js/hs.core.js"></script>
  <script src="../assets/js/components/hs.header.js"></script>
  <script src="../assets/js/components/hs.unfold.js"></script>
  <script src="../assets/js/components/hs.malihu-scrollbar.js"></script>
  <script src="../assets/js/components/hs.validation.js"></script>
  <script src="../assets/js/components/hs.focus-state.js"></script>
  <script src="../assets/js/components/hs.show-animation.js"></script>
  <script src="../assets/js/components/hs.svg-injector.js"></script>
  <script src="../assets/js/components/hs.go-to.js"></script>

  <!-- JS Plugins Init. -->
  <script>


    $(function(){
        $("#header").load("../header.html");
        $("#footer").load("../footer.html");


      $("#table-of-contents").load("table-of-contents-database.html");

    });




    $(window).on('load', function () {
      // initialization of HSMegaMenu component
      $('.js-mega-menu').HSMegaMenu({
        event: 'hover',
        pageContainer: $('.container'),
        breakpoint: 767.98,
        hideTimeOut: 0
      });

      // initialization of svg injector module
      $.HSCore.components.HSSVGIngector.init('.js-svg-injector');
    });

    $(document).on('ready', function () {
      // initialization of header
      $.HSCore.components.HSHeader.init($('#header'));

      // initialization of unfold component
      $.HSCore.components.HSUnfold.init($('[data-unfold-target]'), {
        afterOpen: function () {
          $(this).find('input[type="search"]').focus();
        }
      });

      // initialization of malihu scrollbar
      $.HSCore.components.HSMalihuScrollBar.init($('.js-scrollbar'));

      // initialization of show animations
      $.HSCore.components.HSShowAnimation.init('.js-animation-link');

      // initialization of form validation
      $.HSCore.components.HSValidation.init('.js-validate', {
        rules: {
          confirmPassword: {
            equalTo: '#signupPassword'
          }
        }
      });

      // initialization of forms
      $.HSCore.components.HSFocusState.init();

      // initialization of go to
      $.HSCore.components.HSGoTo.init('.js-go-to');
    });
  </script>
</body>
</html>